<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理画面 - ベステラ社内報</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="https://www.besterra.co.jp/favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <!-- ログイン画面 -->
    <div class="login-overlay" id="login-overlay">
        <div class="login-box">
            <div class="login-header">
                <img src="https://www.besterra.co.jp/images2022/common/logo.svg" alt="BESTERRA" class="login-logo">
                <h1>管理者ログイン</h1>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="admin-password">パスワード</label>
                    <input type="password" id="admin-password" placeholder="管理者パスワードを入力" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full">ログイン</button>
                <p class="login-error" id="login-error"></p>
            </form>
            <a href="index.html" class="back-link">トップページに戻る</a>
        </div>
    </div>

    <!-- 管理画面 -->
    <div class="admin-container" id="admin-container" style="display: none;">
        <!-- ヘッダー -->
        <header class="admin-header">
            <div class="admin-header-content">
                <div class="admin-logo">
                    <img src="https://www.besterra.co.jp/images2022/common/logo_nocatch.svg" alt="BESTERRA" class="logo-img">
                    <span class="admin-title">管理画面</span>
                </div>
                <div class="admin-nav">
                    <a href="index.html" class="btn btn-outline" target="_blank">サイトを見る</a>
                    <button class="btn btn-secondary" onclick="logout()">ログアウト</button>
                </div>
            </div>
        </header>

        <!-- メインコンテンツ -->
        <main class="admin-main">
            <!-- 統計 -->
            <section class="admin-stats">
                <div class="stat-card">
                    <span class="stat-icon">📝</span>
                    <span class="stat-number" id="stat-articles">0</span>
                    <span class="stat-label">記事数</span>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">👁️</span>
                    <span class="stat-number" id="stat-views">0</span>
                    <span class="stat-label">総閲覧数</span>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">💬</span>
                    <span class="stat-number" id="stat-comments">0</span>
                    <span class="stat-label">コメント数</span>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">👍</span>
                    <span class="stat-number" id="stat-reactions">0</span>
                    <span class="stat-label">リアクション数</span>
                </div>
            </section>

            <!-- 記事管理 -->
            <section class="admin-section">
                <div class="section-header">
                    <h2>📰 記事管理</h2>
                    <button class="btn btn-primary btn-large" onclick="openArticleModal()">
                        <span class="btn-icon">+</span> 新しい記事を作成
                    </button>
                </div>

                <div class="help-text">
                    <span class="help-icon">💡</span>
                    記事をクリックして編集できます。右側のボタンで削除できます。
                </div>

                <div class="articles-list" id="articles-list">
                    <!-- JavaScriptで挿入 -->
                </div>
            </section>

            <!-- 設定 -->
            <section class="admin-section">
                <h2>⚙️ 設定</h2>
                <div class="settings-grid">
                    <div class="setting-card">
                        <h3>🔑 パスワード変更</h3>
                        <p>管理者パスワードを変更します</p>
                        <form id="password-form" class="password-form">
                            <div class="form-group">
                                <input type="password" id="new-password" placeholder="新しいパスワード" required>
                            </div>
                            <div class="form-group">
                                <input type="password" id="confirm-password" placeholder="パスワードを再入力" required>
                            </div>
                            <button type="submit" class="btn btn-secondary">変更する</button>
                        </form>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- 記事編集モーダル（フルスクリーン） -->
    <div class="editor-overlay" id="editor-overlay" style="display: none;">
        <div class="editor-container">
            <!-- エディターヘッダー -->
            <header class="editor-header">
                <div class="editor-header-left">
                    <button class="btn btn-icon-only" onclick="closeArticleModal()" title="閉じる">✕</button>
                    <h1 id="editor-title">新しい記事を作成</h1>
                </div>
                <div class="editor-header-right">
                    <button class="btn btn-outline" onclick="closeArticleModal()">キャンセル</button>
                    <button class="btn btn-primary" onclick="saveArticleFromEditor()">
                        <span class="btn-icon">💾</span> 保存する
                    </button>
                </div>
            </header>

            <!-- エディター本体 -->
            <div class="editor-body">
                <!-- 左側：入力エリア -->
                <div class="editor-input">
                    <input type="hidden" id="article-id">

                    <!-- 基本情報 -->
                    <div class="editor-section">
                        <h2 class="editor-section-title">
                            <span class="section-number">1</span>
                            基本情報を入力
                        </h2>

                        <div class="form-group">
                            <label for="article-title">
                                タイトル
                                <span class="required">必須</span>
                            </label>
                            <input type="text" id="article-title" placeholder="例: No.1 人事部・石井/社長室・牛山" required>
                            <span class="form-hint">記事のタイトルを入力してください</span>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="article-category">
                                    カテゴリ
                                    <span class="required">必須</span>
                                </label>
                                <select id="article-category" required>
                                    <option value="">選択してください</option>
                                    <option value="人事部">👥 人事部</option>
                                    <option value="社長室">👔 社長室</option>
                                    <option value="営業部">💼 営業部</option>
                                    <option value="開発部">💻 開発部</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="article-author">
                                    著者名
                                    <span class="required">必須</span>
                                </label>
                                <input type="text" id="article-author" placeholder="例: 牛山" required>
                            </div>
                            <div class="form-group">
                                <label for="article-date">
                                    投稿日
                                    <span class="required">必須</span>
                                </label>
                                <input type="date" id="article-date" required>
                            </div>
                        </div>
                    </div>

                    <!-- 画像選択 -->
                    <div class="editor-section">
                        <h2 class="editor-section-title">
                            <span class="section-number">2</span>
                            ヘッダー画像を選択
                        </h2>

                        <div class="image-selector">
                            <div class="image-tabs">
                                <button type="button" class="image-tab active" onclick="switchImageTab('gallery')">
                                    🖼️ ギャラリー
                                </button>
                                <button type="button" class="image-tab" onclick="switchImageTab('upload')">
                                    📤 アップロード
                                </button>
                                <button type="button" class="image-tab" onclick="switchImageTab('url')">
                                    🔗 URL入力
                                </button>
                            </div>

                            <div class="image-tab-content" id="tab-gallery">
                                <div class="image-gallery">
                                    <div class="image-option selected" data-url="https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=800&h=400&fit=crop">
                                        <img src="https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=200&h=100&fit=crop" alt="チームワーク">
                                        <span>チームワーク</span>
                                    </div>
                                    <div class="image-option" data-url="https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=800&h=400&fit=crop">
                                        <img src="https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=200&h=100&fit=crop" alt="歓迎会">
                                        <span>歓迎会</span>
                                    </div>
                                    <div class="image-option" data-url="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=800&h=400&fit=crop">
                                        <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=100&fit=crop" alt="ビジネス">
                                        <span>ビジネス</span>
                                    </div>
                                    <div class="image-option" data-url="https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=800&h=400&fit=crop">
                                        <img src="https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=200&h=100&fit=crop" alt="データ分析">
                                        <span>データ分析</span>
                                    </div>
                                    <div class="image-option" data-url="https://images.unsplash.com/photo-1551434678-e076c223a692?w=800&h=400&fit=crop">
                                        <img src="https://images.unsplash.com/photo-1551434678-e076c223a692?w=200&h=100&fit=crop" alt="オフィス">
                                        <span>オフィス</span>
                                    </div>
                                    <div class="image-option" data-url="https://images.unsplash.com/photo-1530103862676-de8c9debad1d?w=800&h=400&fit=crop">
                                        <img src="https://images.unsplash.com/photo-1530103862676-de8c9debad1d?w=200&h=100&fit=crop" alt="イベント">
                                        <span>イベント</span>
                                    </div>
                                    <div class="image-option" data-url="https://images.unsplash.com/photo-1497366216548-37526070297c?w=800&h=400&fit=crop">
                                        <img src="https://images.unsplash.com/photo-1497366216548-37526070297c?w=200&h=100&fit=crop" alt="会議室">
                                        <span>会議室</span>
                                    </div>
                                    <div class="image-option" data-url="https://images.unsplash.com/photo-1552664730-d307ca884978?w=800&h=400&fit=crop">
                                        <img src="https://images.unsplash.com/photo-1552664730-d307ca884978?w=200&h=100&fit=crop" alt="プレゼン">
                                        <span>プレゼン</span>
                                    </div>
                                </div>
                            </div>

                            <div class="image-tab-content" id="tab-upload" style="display: none;">
                                <div class="upload-area" id="upload-area">
                                    <div class="upload-placeholder" id="upload-placeholder">
                                        <span class="upload-icon">📷</span>
                                        <p>クリックまたはドラッグ&ドロップで画像をアップロード</p>
                                        <p class="upload-hint">推奨サイズ: 800 x 400 ピクセル（JPG, PNG, GIF対応）</p>
                                        <input type="file" id="image-upload" accept="image/*" hidden>
                                    </div>
                                    <div class="upload-preview" id="upload-preview" style="display: none;">
                                        <img src="" alt="アップロード画像" id="upload-preview-img">
                                        <div class="upload-info" id="upload-info">
                                            <span class="info-name" id="upload-filename">ファイル名</span>
                                            <span class="info-size" id="upload-dimensions">サイズ: 読み込み中...</span>
                                            <span class="info-filesize" id="upload-filesize">ファイルサイズ: 読み込み中...</span>
                                        </div>
                                        <button type="button" class="btn btn-small btn-outline" onclick="clearUploadedImage()">
                                            🗑️ 画像を削除
                                        </button>
                                    </div>
                                </div>
                                <p class="form-hint">※ アップロードした画像はブラウザに保存されます（Base64形式）</p>
                            </div>

                            <div class="image-tab-content" id="tab-url" style="display: none;">
                                <div class="form-group">
                                    <input type="url" id="article-image" placeholder="https://example.com/image.jpg" oninput="loadUrlImageInfo()">
                                    <span class="form-hint">画像のURLを入力してください</span>
                                </div>
                                <div class="url-image-info" id="url-image-info" style="display: none;">
                                    <img src="" alt="" id="url-preview-img">
                                    <div class="upload-info">
                                        <span class="info-size" id="url-dimensions">サイズ: 読み込み中...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 本文入力 -->
                    <div class="editor-section">
                        <h2 class="editor-section-title">
                            <span class="section-number">3</span>
                            記事の内容を入力
                        </h2>

                        <div class="form-group">
                            <label for="article-excerpt">
                                要約（一覧に表示されます）
                                <span class="required">必須</span>
                            </label>
                            <textarea id="article-excerpt" rows="2" placeholder="記事の要約を1〜2文で入力してください" required></textarea>
                            <span class="form-hint">記事一覧で表示される短い説明文です</span>
                        </div>

                        <div class="form-group">
                            <label for="article-body">
                                本文
                                <span class="required">必須</span>
                            </label>

                            <!-- リッチツールバー -->
                            <div class="editor-toolbar-rich">
                                <div class="toolbar-group">
                                    <span class="toolbar-label">テンプレート</span>
                                    <button type="button" class="toolbar-btn" onclick="insertTemplate('greeting')" title="挨拶文">
                                        👋
                                    </button>
                                    <button type="button" class="toolbar-btn" onclick="insertTemplate('list')" title="リスト">
                                        📋
                                    </button>
                                    <button type="button" class="toolbar-btn" onclick="insertTemplate('heading')" title="見出し">
                                        📌
                                    </button>
                                    <button type="button" class="toolbar-btn" onclick="insertTemplate('quote')" title="引用">
                                        💬
                                    </button>
                                </div>
                                <div class="toolbar-divider"></div>
                                <div class="toolbar-group">
                                    <span class="toolbar-label">画像挿入</span>
                                    <button type="button" class="toolbar-btn toolbar-btn-primary" onclick="openImageInsertModal()" title="画像を挿入">
                                        🖼️ 画像
                                    </button>
                                    <button type="button" class="toolbar-btn toolbar-btn-ai" onclick="openAIImageModal()" title="AI画像生成">
                                        ✨ AI生成
                                    </button>
                                </div>
                                <div class="toolbar-divider"></div>
                                <div class="toolbar-group">
                                    <span class="toolbar-label">装飾</span>
                                    <button type="button" class="toolbar-btn" onclick="insertTemplate('divider')" title="区切り線">
                                        ➖
                                    </button>
                                    <button type="button" class="toolbar-btn" onclick="insertTemplate('signature')" title="署名">
                                        ✍️
                                    </button>
                                </div>
                            </div>

                            <textarea id="article-body" rows="18" placeholder="記事の本文を入力してください

【画像の挿入方法】
ツールバーの「🖼️ 画像」または「✨ AI生成」ボタンをクリック

【書式例】
## 見出し
本文テキスト...

[IMAGE:https://example.com/image.jpg|キャプション|center]

さらに本文..." required></textarea>
                            <span class="form-hint">💡 画像は [IMAGE:URL|キャプション|配置] の形式で挿入されます。配置: left, center, right, full</span>
                        </div>
                    </div>
                </div>

                <!-- 右側：プレビュー -->
                <div class="editor-preview">
                    <div class="preview-header">
                        <h2>📱 プレビュー</h2>
                        <span class="preview-hint">実際の表示イメージ</span>
                    </div>
                    <div class="preview-content">
                        <div class="preview-card" id="preview-card">
                            <img src="https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=800&h=400&fit=crop" alt="" class="preview-image" id="preview-image">
                            <div class="preview-body">
                                <span class="preview-category" id="preview-category">カテゴリ</span>
                                <h3 class="preview-title" id="preview-title">タイトルがここに表示されます</h3>
                                <p class="preview-excerpt" id="preview-excerpt">要約がここに表示されます...</p>
                                <div class="preview-meta">
                                    <span id="preview-date">2026/01/09</span>
                                    <span id="preview-author">著者名</span>
                                </div>
                            </div>
                        </div>

                        <div class="preview-detail" id="preview-detail">
                            <h4>本文プレビュー</h4>
                            <div class="preview-detail-body" id="preview-body">
                                本文がここに表示されます...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 画像挿入モーダル -->
    <div class="insert-modal" id="image-insert-modal" style="display: none;">
        <div class="insert-modal-content">
            <div class="insert-modal-header">
                <h3>🖼️ 記事に画像を挿入</h3>
                <button class="btn btn-icon-only" onclick="closeImageInsertModal()">✕</button>
            </div>
            <div class="insert-modal-body">
                <div class="insert-tabs">
                    <button class="insert-tab active" onclick="switchInsertTab('gallery')">ギャラリー</button>
                    <button class="insert-tab" onclick="switchInsertTab('upload')">アップロード</button>
                    <button class="insert-tab" onclick="switchInsertTab('url')">URL入力</button>
                </div>

                <div class="insert-tab-content" id="insert-gallery">
                    <div class="insert-gallery">
                        <div class="insert-image-option" data-url="https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=800">
                            <img src="https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=200" alt="">
                        </div>
                        <div class="insert-image-option" data-url="https://images.unsplash.com/photo-1552664730-d307ca884978?w=800">
                            <img src="https://images.unsplash.com/photo-1552664730-d307ca884978?w=200" alt="">
                        </div>
                        <div class="insert-image-option" data-url="https://images.unsplash.com/photo-1497366216548-37526070297c?w=800">
                            <img src="https://images.unsplash.com/photo-1497366216548-37526070297c?w=200" alt="">
                        </div>
                        <div class="insert-image-option" data-url="https://images.unsplash.com/photo-1551434678-e076c223a692?w=800">
                            <img src="https://images.unsplash.com/photo-1551434678-e076c223a692?w=200" alt="">
                        </div>
                        <div class="insert-image-option" data-url="https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?w=800">
                            <img src="https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?w=200" alt="">
                        </div>
                        <div class="insert-image-option" data-url="https://images.unsplash.com/photo-1531973576160-7125cd663d86?w=800">
                            <img src="https://images.unsplash.com/photo-1531973576160-7125cd663d86?w=200" alt="">
                        </div>
                    </div>
                </div>

                <div class="insert-tab-content" id="insert-upload" style="display: none;">
                    <div class="insert-upload-area" id="insert-upload-area">
                        <span class="upload-icon">📷</span>
                        <p>クリックまたはドラッグ&ドロップ</p>
                        <input type="file" id="insert-image-file" accept="image/*" hidden>
                    </div>
                    <div class="insert-upload-preview" id="insert-upload-preview" style="display: none;">
                        <img src="" alt="" id="insert-preview-img">
                    </div>
                </div>

                <div class="insert-tab-content" id="insert-url" style="display: none;">
                    <input type="url" id="insert-image-url" placeholder="https://example.com/image.jpg" class="insert-url-input">
                </div>

                <div class="insert-options">
                    <div class="form-group">
                        <label>キャプション（任意）</label>
                        <input type="text" id="insert-caption" placeholder="画像の説明文">
                    </div>
                    <div class="form-group">
                        <label>配置</label>
                        <div class="insert-align-options">
                            <label class="align-option">
                                <input type="radio" name="insert-align" value="left"> 左寄せ
                            </label>
                            <label class="align-option">
                                <input type="radio" name="insert-align" value="center" checked> 中央
                            </label>
                            <label class="align-option">
                                <input type="radio" name="insert-align" value="right"> 右寄せ
                            </label>
                            <label class="align-option">
                                <input type="radio" name="insert-align" value="full"> 全幅
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="insert-modal-footer">
                <button class="btn btn-outline" onclick="closeImageInsertModal()">キャンセル</button>
                <button class="btn btn-primary" onclick="insertImageToBody()">挿入する</button>
            </div>
        </div>
    </div>

    <!-- AI画像生成モーダル -->
    <div class="insert-modal" id="ai-image-modal" style="display: none;">
        <div class="insert-modal-content">
            <div class="insert-modal-header">
                <h3>✨ AI画像生成（キーワード検索）</h3>
                <button class="btn btn-icon-only" onclick="closeAIImageModal()">✕</button>
            </div>
            <div class="insert-modal-body">
                <div class="ai-search-box">
                    <input type="text" id="ai-keyword" placeholder="キーワードを入力（例: オフィス, チームワーク, 会議）" class="ai-keyword-input">
                    <button class="btn btn-primary" onclick="searchAIImages()">🔍 検索</button>
                </div>
                <p class="ai-hint">Unsplashから高品質な写真を検索します。英語キーワードも使用可能です。</p>

                <div class="ai-results" id="ai-results">
                    <div class="ai-placeholder">
                        <span>🎨</span>
                        <p>キーワードを入力して検索してください</p>
                    </div>
                </div>

                <div class="insert-options" id="ai-options" style="display: none;">
                    <div class="form-group">
                        <label>キャプション（任意）</label>
                        <input type="text" id="ai-caption" placeholder="画像の説明文">
                    </div>
                    <div class="form-group">
                        <label>配置</label>
                        <div class="insert-align-options">
                            <label class="align-option">
                                <input type="radio" name="ai-align" value="left"> 左寄せ
                            </label>
                            <label class="align-option">
                                <input type="radio" name="ai-align" value="center" checked> 中央
                            </label>
                            <label class="align-option">
                                <input type="radio" name="ai-align" value="right"> 右寄せ
                            </label>
                            <label class="align-option">
                                <input type="radio" name="ai-align" value="full"> 全幅
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="insert-modal-footer">
                <button class="btn btn-outline" onclick="closeAIImageModal()">キャンセル</button>
                <button class="btn btn-primary" id="ai-insert-btn" onclick="insertAIImageToBody()" disabled>挿入する</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="admin.js"></script>
</body>
</html>
